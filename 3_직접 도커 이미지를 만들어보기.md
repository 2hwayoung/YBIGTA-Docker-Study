# 3장. 직접 도커 이미지를 만들어보기

강의: [인프런_따라하며 배우는 도커와 CI 환경](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8F%84%EC%BB%A4-ci/) (John Ahn 강사님) 

발제자: 김희진
날짜: 21.01.12



## 1. 도커 이미지 생성 순서

![Untitled 1](https://user-images.githubusercontent.com/69383392/104309550-aff9f400-5515-11eb-82e5-d072e43a21f9.png)

Docker hub에 존재하는 이미지를 가져와 사용하는 방법도 있지만, **직접 도커 이미지를 만들어서** 사용 및 Docker hub에의 배포가 가능하다. 



### - 1. Docker file이란?

도커 이미지를 만들기 위한 설정 파일. 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의해준다. 



### - 2. 도커파일 만드는 순서

1. **베이스 이미지** 명시 = 파일 스냅샷에 해당
2. 추가적으로 필요한 파일을 다운 받기 위한 몇 가지 명령어를 명시 = 파일 스냅샷에 해당
3. 컨테이너 시작 시 실행될 명령어를 명시 = 시작시 실행 될 명령어에 해당



### - 3. 베이스 이미지란?

- 도커 이미지는 여러 개의 레이어로 되어 있다.

- 베이스 이미지란, 이미지의 기반이 되는 부분

![Untitled 2](https://user-images.githubusercontent.com/69383392/104309573-b9835c00-5515-11eb-91cc-b1270338cf58.png)



### - 4. Dockerfile 생성

```docker
# 베이스 이미지를 명시해준다.
FROM baseImage

# 추가적으로 필요한 파일들을 다운로드 받는다.
RUN command

# 컨테이너 시작 시 실행될 명령어를 명시해준다.
CMD ["executable"]
```

- **FROM**

  - 이미지 생성 시 **기반**이 되는 이미지 레이어
  - [이미지이름]:[태그] 형식
    - 태그를 안붙이면 자동적으로 가장 최신 것으로 다운 받음
    - ex. ubuntu:18.04

- **RUN**

  - 도커 이미지가 생성되기 전에 수행할 쉘 명령어
  - 베이스 이미지 이외에도 필요한 것들을 첨가해주는 데 사용한다.

- **CMD**

  - 컨테이너가 시작되었을 때 실행할 실행파일 혹은 셀 스크립트
  - 해당 명령어는 Dockerfile 내 **1회만** 쓸 수 있다.

  

### - 5. 도커 클라이언트 - 도커 서버

- build 명령어: 해당 디렉토리 내에서 dockerfile이라는 파일을 (알아서) 찾아서 도커 클라이언트에 전달시켜준다.

```docker
# 디렉토리를 명시해준다. ./, .는 현재 디렉토리를 가리킨다.
docker build ./
docker build .
```

- 자세한 순서
  1. 베이스 이미지를 임시 컨테이너에 넣어준다.
  2. 베이스 이미지 이외의 레이어를 넣어준다. (RUN part)
  3. 명시된 "시작 시 실행될 명령어" 추가
  4. 임시 컨테이너를 토대로 새로운 이미지 생성
  5. (임시 컨테이너를 지운다)

![Untitled 3](https://user-images.githubusercontent.com/69383392/104309604-c3a55a80-5515-11eb-8b7d-189777e06203.png)



### - 6. 도커이미지에 이름 부여하기

```docker
docker build -t [도커아이디]/[저장소,프로젝트이름]:[버전] .
```





---

이미지 출처: [인프런_따라하며 배우는 도커와 CI 환경](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8F%84%EC%BB%A4-ci/) (John Ahn 강사님) 에서의 1-3 강의자료

실습을 포함한 더 자세한 노트: [Notion](https://www.notion.so/gimmizz/159c9031f56d4c638c3caf4c3c86b816)

